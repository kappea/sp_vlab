$.fn.topicSearch=function(){return this.each(function(){function c(){h(),p(),y()}function h(){e.on("submit",function(e){e.preventDefault(),v(n.val())}),e.find(".clearField").on("click",function(){m()}),n.on("keyup",function(){$(this).val()===""&&m()}),r.find("h3 a").on("click",function(e){if(Core.viewport==="mobile"||Core.viewport==="phablet"){e.preventDefault();var t=$(this),n=$(this).parent("h3").next("ul");t.hasClass("panelOpen")?(t.removeClass("panelOpen"),n.removeClass("panelOpen")):(t.addClass("panelOpen"),n.addClass("panelOpen"))}})}function p(){s.each(function(e,t){var n=$(this).html().toLowerCase().trim().replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"");$(this).attr("data-topicid",e),a.indexOf(n)<0&&n!==""&&a.push(n);if($(this).data("alternative-spellings")){var r=$(this).data("alternative-spellings").toString(),i=r.split(", ");$.each(i,function(e,t){searchOption=t.toLowerCase().trim().replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,""),a.indexOf(searchOption)<0&&searchOption!==""&&a.push(searchOption)})}}),a.sort(),d()}function d(){var e=10;n.autocomplete({minLength:1,delay:200,appendTo:"#topicSearch",source:function(e,t){var n=new RegExp("^"+$.ui.autocomplete.escapeRegex(e.term),"i");t($.grep(a,function(e){return n.test(e)}))},select:function(e,t){v(t.item.value)},open:function(e,t){$(".ui-autocomplete").scrollTop(0),$(".ui-autocomplete").find("li").attr("role","option")},create:function(e,t){$(".ui-autocomplete").attr("role","listbox")}}),n.attr("aria-autocomplete","inline"),n.attr("role","combobox")}function v(e){$(".ui-autocomplete").scrollTop(0),n.autocomplete("close");var t=[],i=e.toLowerCase().replace(/[^a-z\d\s]+/gi,"").trim();i.length>1?($(".populairTopicsWrapper").hide(),$(".topicList li a").each(function(e,n){var r=$(this).html().toLowerCase().replace(/[^a-z\d\s]+/gi,"").trim(),s=$(this).attr("data-topicid");if(i===r)t.push({topicid:s,rank:1});else if(r.indexOf(i)>=0)t.push({topicid:s,rank:2});else if($(this).data("alternative-spellings")){var o=$(this).data("alternative-spellings").toString(),u=o.split(", ");$.each(u,function(e,n){var r=n.toLowerCase().replace(/[^a-z\d\s]+/gi,"").trim();r!==""&&(i===r?t.push({topicid:s,rank:3,keyword:r}):r.indexOf(i)>=0&&t.push({topicid:s,rank:4,keyword:r}))})}}),t.sort(function(e,t){return e.rank-t.rank}),g(t,i)):($(".topicResults").remove(),r.show())}function m(){$(".topicResults").remove(),$(".populairTopicsWrapper").show(),n.val("").trigger("change"),r.show()}function g(e,n){$(".topicResults").remove(),$(".showList").show(),r.hide();var s=$("<div/>",{"class":"topicResults",html:"<h2>"+l.results+"</h2>"}).appendTo(".topicSearchWrapper"),o=[],u=Object.keys(e).length;u>0?($.each(e,function(e,n){var u=r.find("a[data-topicid='"+n.topicid+"']"),a=[];if(u.attr("data-alternative-spellings")){var f=u.attr("data-alternative-spellings").toString().split(", ");for(i=a.length;i<5;){if(typeof f[i]!="undefined"){var c=f[i].trim().replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"");c!==""&&a.indexOf(c)===-1&&a.push(c)}i++}}var h="";if(a.length>0){var p="";for(t=0;t<3;t++)typeof a[t]!="undefined"&&(p+=a[t]),t<2&&typeof a[t+1]!="undefined"&&(p+=", ");h="<p>"+l.foundOn+": "+p+"</p>"}if(o.indexOf(u.html())===-1){o.push(u.html());var d=$("<div/>",{"class":"foundTopic"}).appendTo(s),v=$("<a/>",{href:u.attr("href"),"data-keyword":u.html(),html:"<h3>"+u.html()+"</h3>"+h}).appendTo(d);v.on("click",function(){_paq.push(["trackEvent","Onderwerp overzicht","Gevonden onderwerp openen",$(this).data("keyword")])})}}),_paq.push(["trackEvent","Onderwerp overzicht","Onderwerp zoeken",n,o.length])):(_paq.push(["trackEvent","Onderwerp overzicht","Onderwerp zoeken",n,"0"]),$("<p/>",{html:l.noresults}).appendTo(s),$("<button/>",{id:"showAllTopics",text:l.noResultsBtn}).appendTo(s).on("click",function(e){e.preventDefault(),m()}))}function y(){$("a[href='#topic-home']").click(function(e){e.preventDefault(),e.stopPropagation();var t=$(this.hash),n="a[name="+this.hash.slice(1)+"]";t=t.length&&t||$(n);var r=t.offset().top;$("html, body").stop().animate({scrollTop:r},500)})}var e=$(this),n=$("#topicQ"),r=$(".topicList"),s=r.find("li a"),o=$(".topicsList"),u="",a=[],f={},l={results:e.attr("data-results")||"Gevonden onderwerpen",noresults:e.attr("data-noresults")||"Geen onderwerpen gevonden",noResultsBtn:e.attr("data-show-all-btn-txt")||"Toon alle onderwerpen",foundOn:e.attr("data-found-on-keyword")||"Gaat over"};c()})},$("#topicSearch").topicSearch()
